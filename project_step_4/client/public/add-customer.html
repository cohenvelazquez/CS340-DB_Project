<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Customer - Banana Phone Estate Services</title>
    <link rel="stylesheet" href="styles.css">
    <script src="data.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Add New Customer</h1>
            <nav class="breadcrumb">
                <a href="index.html">Home</a> > <a href="customers.html">Customers</a> > Add Customer
            </nav>
        </header>

        <div class="form-container">
            <div class="form-card">
                <h2>Customer Information</h2>
                <form id="addCustomerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name: *</label>
                            <input type="text" id="firstName" name="firstName" required maxlength="50" placeholder="Enter first name">
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name: *</label>
                            <input type="text" id="lastName" name="lastName" required maxlength="50" placeholder="Enter last name">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address: *</label>
                        <input type="email" id="email" name="email" required maxlength="100" placeholder="customer@email.com">
                        <small class="form-help">Email address must be unique</small>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number: *</label>
                        <input type="tel" id="phone" name="phone" required maxlength="20" placeholder="(503) 555-0123">
                        <small class="form-help">Include area code for better contact</small>
                    </div>

                    <div class="form-group">
                        <label for="notes">Notes (Optional):</label>
                        <textarea id="notes" name="notes" rows="3" maxlength="500" placeholder="Any additional notes about the customer..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Add Customer</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelAdd()">Cancel</button>
                        <button type="button" class="btn btn-outline" onclick="clearForm()">Clear Form</button>
                    </div>
                </form>
            </div>

            <div class="info-card">
                <h3>Customer Registration Guidelines</h3>
                <ul>
                    <li><strong>Required Information:</strong> All fields marked with * are required</li>
                    <li><strong>Email Verification:</strong> System will check for duplicate email addresses</li>
                    <li><strong>Phone Format:</strong> Enter 10-digit US phone numbers with area code</li>
                    <li><strong>Data Privacy:</strong> Customer information is securely stored and protected</li>
                    <li><strong>Communication:</strong> Customers may receive sale notifications via email</li>
                </ul>
            </div>
        </div>

        <div class="recent-customers">
            <h3>Recently Added Customers</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Date Added</th>
                        </tr>
                    </thead>
                    <tbody id="recentCustomersTable">
                        <!-- Data populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Function to validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Function to validate phone format
        function isValidPhone(phone) {
            const phoneRegex = /^[\(\)\-\s\d\+]+$/;
            return phoneRegex.test(phone) && phone.replace(/\D/g, '').length >= 10;
        }

        // Function to check for duplicate email
        function isDuplicateEmail(email) {
            const customers = getAllCustomers();
            return customers.some(customer => 
                customer.email.toLowerCase() === email.toLowerCase()
            );
        }

        // Function to format phone number
        function formatPhoneNumber(phone) {
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 10) {
                return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
            }
            return phone;
        }

        // Function to handle form submission
        function handleSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const customerData = {
                firstName: formData.get('firstName').trim(),
                lastName: formData.get('lastName').trim(),
                email: formData.get('email').trim(),
                phone: formData.get('phone').trim(),
                notes: formData.get('notes').trim()
            };
            
            // Validate required fields
            if (!customerData.firstName || !customerData.lastName || !customerData.email || !customerData.phone) {
                alert('Please fill in all required fields');
                return;
            }

            // Validate email format
            if (!isValidEmail(customerData.email)) {
                alert('Please enter a valid email address');
                return;
            }

            // Check for duplicate email
            if (isDuplicateEmail(customerData.email)) {
                alert('Email address already exists. Please use a different email.');
                return;
            }

            // Validate phone format
            if (!isValidPhone(customerData.phone)) {
                alert('Please enter a valid phone number with area code');
                return;
            }

            // Format phone number
            customerData.phone = formatPhoneNumber(customerData.phone);

            // Generate new customer ID (in real implementation, this would be auto-generated by database)
            const customers = getAllCustomers();
            const newCustomerId = Math.max(...customers.map(c => c.customerID)) + 1;

            // Create customer object
            const newCustomer = {
                customerID: newCustomerId,
                firstName: customerData.firstName,
                lastName: customerData.lastName,
                email: customerData.email,
                phone: customerData.phone,
                created_at: new Date().toISOString(),
                totalPurchases: 0,
                numberOfSales: 0,
                notes: customerData.notes
            };

            // In a real application, this would make an API call to save the customer
            console.log('New customer to be saved:', newCustomer);
            
            alert(`Successfully added customer: ${customerData.firstName} ${customerData.lastName}`);
            
            // Redirect to customers page
            window.location.href = 'customers.html';
        }

        // Function to clear form
        function clearForm() {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.getElementById('addCustomerForm').reset();
                document.getElementById('firstName').focus();
            }
        }

        // Function to cancel add
        function cancelAdd() {
            if (confirm('Are you sure you want to cancel? All entered data will be lost.')) {
                window.location.href = 'customers.html';
            }
        }

        // Function to load recent customers
        function loadRecentCustomers() {
            const customers = getAllCustomers();
            const recentCustomers = customers
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                .slice(0, 5);

            const tableBody = document.getElementById('recentCustomersTable');
            if (!tableBody) {
                console.error('Recent customers table not found');
                return;
            }

            tableBody.innerHTML = '';

            if (recentCustomers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="no-data">No customers found</td>
                `;
                tableBody.appendChild(row);
                return;
            }

            recentCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.firstName} ${customer.lastName}</td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td>${new Date(customer.created_at).toLocaleDateString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load recent customers
            loadRecentCustomers();
            
            // Add form submit listener
            document.getElementById('addCustomerForm').addEventListener('submit', handleSubmit);
            
            // Add phone formatting
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length >= 6) {
                    value = `(${value.slice(0,3)}) ${value.slice(3,6)}-${value.slice(6,10)}`;
                } else if (value.length >= 3) {
                    value = `(${value.slice(0,3)}) ${value.slice(3)}`;
                }
                this.value = value;
            });

            // Focus on first input
            document.getElementById('firstName').focus();
        });
    </script>

    <style>
        .form-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .info-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .info-card h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #2563eb;
        }

        .info-card ul {
            margin: 0;
            padding-left: 1.25rem;
        }

        .info-card li {
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .form-help {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .recent-customers {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recent-customers h3 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }

        .no-data {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
